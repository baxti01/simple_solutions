<html data-bs-theme="dark" lang="ru">
<head>
    <title>{% block main_title %}{% endblock %}</title>
    <script src="https://js.stripe.com/v3/"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<header class="bg-success p-2">
    <h5 class="m-0">Rank - test task</h5>
</header>
{% block content %}{% endblock %}
{% if buy_url %}
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', async () => {
            // При замене ключей api она будет меняться автоматически
            const {public_key} = await fetch('/config', {method: 'GET'}).then(r => r.json())

            const stripe = Stripe(public_key);
            const buyButton = document.getElementById('buy-button');
            buyButton.addEventListener('click', async () => {
                const {session_id} = await fetch(
                    '{{ buy_url }}', {method: 'GET'}
                ).then(r => r.json())
                stripe.redirectToCheckout({sessionId: session_id})
            })
        })
    </script>
{% endif %}
</body>
</html>
